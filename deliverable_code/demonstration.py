from path_planner import plan_path
import numpy as np
from matplotlib import pyplot as plt
import time
import params

def get_bearing_size_measurements(filepath):
    data = np.load(filepath)
    bearings = [[] for _ in range(data.shape[1])]
    sizes = [[] for _ in range(data.shape[1])]
    for i in range(params.measured_window):
        for j in range(data.shape[1]):
            bearings[j].append(data[i][j,0])
            sizes[j].append(data[i][j,1])
    return bearings, sizes

def get_ownship_intruder_positions(filepath):
    real = np.load(filepath)
    ownship = real[0]
    intruders = []
    for intruder in real[1:]:
        intruders.append(intruder)
    return ownship, intruders

def plot_control_points(cntrl_pts):
    for i in range(0, len(cntrl_pts), 2):
        plt.plot(cntrl_pts[i+1], cntrl_pts[i], 'ko')
    
    plt.axis('equal')
    plt.show()


# Example usage of the path planner
# bearings, sizes = get_bearing_size_measurements("deliverable_code/xplane_data/0005/20241205_153033_bearing_info.npy")
# ownship, intruders = get_ownship_intruder_positions("deliverable_code/xplane_data/0005/20241205_153033_all_positions_in_path.npy")
bearings = np.array([[0.29155565775745285, 0.2914593114585339, 0.2912552394692298, 0.29111767825799095, 0.2909223733776699, 0.29074409127280254, 0.29062900473161746, 0.2903851230430035, 0.29018950121221626, 0.29003796961565104, 0.2898943187556561, 0.2896954586278995, 0.28944044948184644, 0.2891727337610854, 0.2889756718023907, 0.2887323963935218, 0.2884565994787635, 0.28824519909444146, 0.2879755136342363, 0.2876381252672007, 0.28748919636583337, 0.2871959489962756, 0.2869311355633265, 0.28666723266263294, 0.2861910113947065, 0.2859867700159876, 0.2855498267925986, 0.2851409459193159, 0.28484655197270026, 0.2844320512753471]])
sizes = np.array([[0.009483780532323119, 0.009557141129257408, 0.009626017375171379, 0.009684288673678078, 0.009764706352449554, 0.009830678096741933, 0.0098984823152694, 0.009988695579968324, 0.010058750309571034, 0.010146556061082567, 0.010208163597772709, 0.01029211320812365, 0.010373082022593858, 0.010468838399228748, 0.010540070773380008, 0.010631904248875246, 0.010716037391215301, 0.01080263468533703, 0.010885790029059613, 0.010992568864778427, 0.011056052226472374, 0.01116862345469787, 0.01125103673623278, 0.011333362750674226, 0.01146269402328619, 0.011535864605560093, 0.011646077317457783, 0.011765624080267068, 0.011854425800818578, 0.011976788268715956]])
ownship = np.array([[-0.1471664471837837, 229.2655761315117], [-0.14716806842481223, 229.32920041788384], [-0.14716899535538897, 229.36555715504318], [-0.1471715440515391, 229.46553818152864], [-0.14717247150707546, 229.50189491365734], [-0.14717409464072073, 229.56551920187366], [-0.1471761819716182, 229.64732185823107], [-0.14717826944064516, 229.72912451498829], [-0.14717966222654955, 229.78365961710222], [-0.14718082307595814, 229.8291055386993], [-0.1471833774641027, 229.92908655985622], [-0.14718477112724404, 229.98362166269234], [-0.1471863970307412, 230.04724595347494], [-0.1471884892177222, 230.12904860753528], [-0.1471894190700187, 230.16540534478438], [-0.1471919772917829, 230.26538636795274], [-0.1471931400755615, 230.310832287163], [-0.14719523415515123, 230.3926349430675], [-0.14719663096122915, 230.4471700459158], [-0.14719919194619102, 230.5471510690964], [-0.14719919194619102, 230.5471510690964], [-0.14720175418814208, 230.64713209299913], [-0.14720385094784927, 230.7289347493932], [-0.147204783853355, 230.7652914845778], [-0.1472068823608721, 230.84709413986207], [-0.14720898110999947, 230.92889679474655], [-0.1472106136023097, 230.9925207238942], [-0.14721201373785497, 231.04705582547768], [-0.1472136478473116, 231.11068011237614], [-0.14721621654794959, 231.21066113790266]])
# print(bearings)
start = time.time()
cntrl_pts = plan_path(bearings, sizes, ownship, 1, params.safety_threshold)
end = time.time()
print("\nTime taken to plan path: ", end - start, " seconds\n")
plot_control_points(cntrl_pts)



